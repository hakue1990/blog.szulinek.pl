<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="noindex, nofollow"><title>Nginx proxy and webserver | IT Tech Anytime</title>
<meta name=keywords content="nginx,webserver"><meta name=description content="Nginix webserver"><meta name=author content><link rel=canonical href=http://localhost:1313/en/posts/nginx/><link crossorigin=anonymous href=/assets/css/stylesheet.d13c3c6200e155c2196e3ebb0e154eb2c43e63128415ebb5249050b767479b1a.css integrity="sha256-0Tw8YgDhVcIZbj67DhVOssQ+YxKEFeu1JJBQt2dHmxo=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/assets/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/assets/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/assets/favicon/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/assets/favicon/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/en/posts/nginx/><link rel=alternate hreflang=pl href=http://localhost:1313/pl/posts/nginx/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/en/ accesskey=h title="Szulinek IT (Alt + H)"><img src=http://localhost:1313/img/logo.png alt aria-label=logo height=40>Szulinek IT</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=http://localhost:1313/pl/ title=Polski aria-label=:pl:>Pl</a></li></ul></div></div><ul id=menu><li><a href=http://localhost:1313/en/about title=Whoami><span>Whoami</span></a></li><li><a href=http://localhost:1313/en/services/ title=Services><span>Services</span></a></li><li><a href=http://localhost:1313/en/posts/ title=Blog><span>Blog</span></a></li><li><a href=http://localhost:1313/en/www/ title=Websites><span>Websites</span></a></li><li><a href=http://localhost:1313/en/contact/ title=Contact><span>Contact</span></a></li><li><a href=https://portfolio.szulinek.pl title=Portfolio><span>Portfolio</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul><button class=hamburger>
<span class=hamburger__box><span class=hamburger__inner></span></span></button></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/en/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/en/posts/>Posts</a></div><h1 class=post-title>Nginx proxy and webserver</h1><div class=post-description>Nginix webserver</div><div class=post-meta>&lt;span title='2024-04-02 21:30:35 +0200 CEST'>April 2, 2024&lt;/span>&amp;nbsp;·&amp;nbsp;7 min&amp;nbsp;·&amp;nbsp;1367 words&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=http://localhost:1313/pl/posts/nginx/>Pl</a></li></ul></div></header><figure class=entry-cover><img loading=lazy src=http://localhost:1313/img/post-images/nginxx.png alt=nginx></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#introduction>Introduction:</a><ul><li><a href=#today-well-consider-about>Today we&rsquo;ll consider about:</a></li></ul></li><li><a href=#what-is-nginx>What is Nginx?</a></li><li><a href=#basic-commands>Basic Commands:</a></li><li><a href=#directive-and-context>Directive and Context</a></li><li><a href=#types-of-directives>Types of Directives</a><ul><li><a href=#normal>Normal</a></li><li><a href=#array>Array</a></li><li><a href=#action-directive>Action Directive</a></li></ul></li><li><a href=#handling-requests>Handling Requests</a><ul><li><a href=#server_name-directive>server_name Directive</a></li><li><a href=#listen-directive>listen Directive</a></li></ul></li><li><a href=#minimal-configuration>Minimal Configuration</a></li><li><a href=#root-location-and-try_files-directives>root, location, and try_files Directives</a><ul><li><a href=#root-directive>root Directive</a></li><li><a href=#location-directive>location Directive</a></li><li><a href=#try_files-directive>try_files Directive</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=introduction>Introduction:<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><h3 id=today-well-consider-about>Today we&rsquo;ll consider about:<a hidden class=anchor aria-hidden=true href=#today-well-consider-about>#</a></h3><ul><li><em>Basic Concepts:</em> Understanding the difference between directive and context, inheritance model, and the order in which nginx selects server blocks and locations.</li></ul><h2 id=what-is-nginx>What is Nginx?<a hidden class=anchor aria-hidden=true href=#what-is-nginx>#</a></h2><p>Nginx is a versatile web server known for its exceptional speed. Besides serving web content, it functions as a reverse proxy server and proxy, facilitating smooth integration with slower upstream servers like Unicorn or Puma. Nginx allows traffic distribution through load balancing, supports media streaming, dynamic image resizing, content caching, and much more. Its architecture consists of a master process overseeing worker processes responsible for handling requests, ensuring efficient operation.</p><h2 id=basic-commands>Basic Commands:<a hidden class=anchor aria-hidden=true href=#basic-commands>#</a></h2><p>To start nginx, simply type:</p><pre tabindex=0><code>[sudo] nginx
</code></pre><p>Once your nginx server is running, you can manage it by sending signals:</p><pre tabindex=0><code>[sudo] nginx -s signal
</code></pre><p>Available signals:</p><ul><li><code>stop:</code> quick shutdown</li><li><code>quit:</code> graceful shutdown (waits for workers to finish processing)</li><li><code>reload:</code> reload configuration file</li><li><code>reopen:</code> reopen log files</li></ul><h2 id=directive-and-context>Directive and Context<a hidden class=anchor aria-hidden=true href=#directive-and-context>#</a></h2><p>By default, the nginx configuration file is located at:</p><p><code>/etc/nginx/nginx.conf</code>,</p><p><code>/usr/local/etc/nginx/nginx.conf</code>,</p><p>or <code>/usr/local/nginx/conf/nginx.conf</code></p><p>This file consists of:</p><ul><li>directive: an option consisting of a name and parameters; should end with a semicolon</li></ul><p><code>gzip on;</code></p><ul><li>context: a section where you can declare directives (similar to scope in programming languages)</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>
</span></span><span class=line><span class=cl>worker_processes 2<span class=p>;</span> <span class=c1># directive in global context</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>http <span class=o>{</span>              <span class=c1># http context</span>
</span></span><span class=line><span class=cl>    gzip on<span class=p>;</span>        <span class=c1># directive in http context</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  server <span class=o>{</span>          <span class=c1># server context</span>
</span></span><span class=line><span class=cl>    listen 80<span class=p>;</span>      <span class=c1># directive in server context</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=types-of-directives>Types of Directives<a hidden class=anchor aria-hidden=true href=#types-of-directives>#</a></h2><p>You need to be careful when using the same directive in multiple contexts because the inheritance model differs for different directives. There are 3 types of directives, each with its own inheritance model.</p><h3 id=normal>Normal<a hidden class=anchor aria-hidden=true href=#normal>#</a></h3><p>It has one value per context. Additionally, it can be defined only once within a context. Child contexts can override the parent directive, but this override will only be significant within that particular child context.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gzip on<span class=p>;</span>
</span></span><span class=line><span class=cl>gzip off<span class=p>;</span> <span class=c1># having 2 normal directives in the same context is illegal</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>  location /downloads <span class=o>{</span>
</span></span><span class=line><span class=cl>    gzip off<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  location /assets <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1># gzip is here</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=array>Array<a hidden class=anchor aria-hidden=true href=#array>#</a></h3><p>Adding multiple directives within the same context will add values instead of completely overriding them. Defining a directive within a child context will override ALL parent values within that child context.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>error_log</span> <span class=s>/var/log/nginx/error.log</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>error_log</span> <span class=s>/var/log/nginx/error_notice.log</span> <span class=s>notice</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>error_log</span> <span class=s>/var/log/nginx/error_debug.log</span> <span class=s>debug</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>location</span> <span class=s>/downloads</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1># this will override all parent directives
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>error_log</span> <span class=s>/var/log/nginx/error_downloads.log</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=action-directive>Action Directive<a hidden class=anchor aria-hidden=true href=#action-directive>#</a></h3><p>Action directives are directives that change something. Their inheritance behavior will depend on the module.</p><p>For instance, in the case of the rewrite directive, every matching directive will be executed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>rewrite</span> <span class=s>^</span> <span class=s>/foobar</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>location</span> <span class=s>/foobar</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>rewrite</span> <span class=s>^</span> <span class=s>/foo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>rewrite</span> <span class=s>^</span> <span class=s>/bar</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>If a user tries to retrieve /anything:</p><ul><li>The server rewrite will be executed, redirecting from /anything to /foobar</li><li>The /foobar location will match</li><li>The first location rewrite will be executed, redirecting from /foobar to /foo</li><li>The second location rewrite will be executed, redirecting from /foo to /bar</li></ul><p>This is different behavior from what the return directive provides:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>200</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>404</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In the above case, a <code>200</code> status will be immediately returned.</p><h2 id=handling-requests>Handling Requests<a hidden class=anchor aria-hidden=true href=#handling-requests>#</a></h2><p>Inside nginx, you can define multiple virtual servers, each described by the <code>server { }</code> context.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>listen</span>      <span class=s>*:80</span> <span class=s>default_server</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>server_name</span> <span class=s>szulinek.pl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#34;Welcome</span> <span class=s>from</span> <span class=s>szulinek.pl&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>listen</span>      <span class=s>*:80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>server_name</span> <span class=s>foo.co</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#34;Welcome</span> <span class=s>from</span> <span class=s>foo.co&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>listen</span>      <span class=s>*:81</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>server_name</span> <span class=s>bar.co</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#34;Welcome</span> <span class=s>from</span> <span class=s>bar.co&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This allows nginx to specify how to handle incoming requests. Nginx first checks the listen directive to determine which virtual server is listening on a given IP:port combination. Then it checks the value from the server_name directive against the Host header, which holds the server&rsquo;s domain name.</p><p>Nginx selects the virtual server in the following order:</p><ul><li>Server listening on IP:port, with a matching server_name directive;</li><li>Server listening on IP:port, with the default_server flag;</li><li>Server listening on IP:port, first defined;</li><li>If no matches are found, reject the connection.</li></ul><p>In the above example, this means:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>Request</span> <span class=s>for</span> <span class=n>foo.co</span><span class=p>:</span><span class=mi>80</span>     <span class=p>=</span><span class=s>&gt;</span> <span class=s>&#34;Welcome</span> <span class=s>from</span> <span class=s>foo.co&#34;</span>
</span></span><span class=line><span class=cl><span class=s>Request</span> <span class=s>for</span> <span class=n>www.foo.co</span><span class=p>:</span><span class=mi>80</span> <span class=p>=</span><span class=s>&gt;</span> <span class=s>&#34;Welcome</span> <span class=s>from</span> <span class=s>szulinek.pl&#34;</span>
</span></span><span class=line><span class=cl><span class=s>Request</span> <span class=s>for</span> <span class=n>bar.co</span><span class=p>:</span><span class=mi>80</span>     <span class=p>=</span><span class=s>&gt;</span> <span class=s>&#34;Welcome</span> <span class=s>from</span> <span class=s>szulinek.pl&#34;</span>
</span></span><span class=line><span class=cl><span class=s>Request</span> <span class=s>for</span> <span class=n>bar.co</span><span class=p>:</span><span class=mi>81</span>     <span class=p>=</span><span class=s>&gt;</span> <span class=s>&#34;Welcome</span> <span class=s>from</span> <span class=s>bar.co&#34;</span>
</span></span><span class=line><span class=cl><span class=s>Request</span> <span class=s>for</span> <span class=n>foo.co</span><span class=p>:</span><span class=mi>81</span>     <span class=p>=</span><span class=s>&gt;</span> <span class=s>&#34;Welcome</span> <span class=s>from</span> <span class=s>bar.co&#34;</span>
</span></span></code></pre></div><h3 id=server_name-directive>server_name Directive<a hidden class=anchor aria-hidden=true href=#server_name-directive>#</a></h3><p>The <code>server_name</code> directive accepts multiple values. It also supports matching using wildcards and regular expressions.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server_name</span> <span class=s>szulinek.pl</span> <span class=s>www.szulinek.pl</span><span class=p>;</span> <span class=c1># exact match
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>server_name</span> <span class=s>*.szulinek.pl</span><span class=p>;</span>              <span class=c1># wildcard match
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>server_name</span> <span class=s>szulinek.*</span><span class=p>;</span>                 <span class=c1># wildcard match
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>server_name</span>  <span class=p>~</span><span class=sr>^[0-9]*\.szulinek\.pl$;</span>   <span class=c1># regular expression match
</span></span></span></code></pre></div><p>In case of ambiguity, nginx follows this order:</p><ol><li>Exact name;</li><li>Longest wildcard name starting with an asterisk, e.g., “*.example.org”;</li><li>Longest wildcard name ending with an asterisk, e.g., “mail.*”;</li><li>First regular expression match (in the order they appear in the configuration file).</li></ol><p>Nginx maintains 3 hash tables: exact names, wildcard names starting with an asterisk, and wildcard names ending with an asterisk. If the result is not found in any of these tables, regular expressions will be tested sequentially.</p><p>It&rsquo;s worth noting that</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server_name</span> <span class=s>.szulinek.pl</span><span class=p>;</span>
</span></span></code></pre></div><p>is a shorthand for:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server_name</span>  <span class=s>szulinek.pl</span>  <span class=s>www.szulinek.pl</span>  <span class=s>*.szulinek.pl</span><span class=p>;</span>
</span></span></code></pre></div><p>With one difference: <code>.szulinek.pl</code> is stored in the second table, which means it&rsquo;s slightly slower than explicitly declared.</p><h3 id=listen-directive>listen Directive<a hidden class=anchor aria-hidden=true href=#listen-directive>#</a></h3><p>In most cases, you&rsquo;ll notice that the <code>listen</code> directive accepts IP:port values.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>listen</span> <span class=n>127.0.0.1</span><span class=p>:</span><span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>listen</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=mi>127</span><span class=s>.0.0.1</span><span class=p>;</span>    <span class=c1># defaults to port :80
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>listen</span> <span class=s>*:81</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>listen</span> <span class=mi>81</span><span class=p>;</span>           <span class=c1># defaults to all IP addresses
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>listen</span> <span class=s>[::]:80</span><span class=p>;</span>      <span class=c1># IPv6 addresses
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>listen</span> <span class=s>[::1]</span><span class=p>;</span>        <span class=c1># IPv6 addresses
</span></span></span></code></pre></div><p>However, you can also specify UNIX domain sockets:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>listen</span> <span class=s>unix:/var/run/nginx.sock</span><span class=p>;</span>
</span></span></code></pre></div><p>You can even use hostnames:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>listen</span> <span class=n>localhost</span><span class=p>:</span><span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>listen</span> <span class=n>szulinek.pl</span><span class=p>:</span><span class=mi>80</span><span class=p>;</span>
</span></span></code></pre></div><p>However, use this cautiously because the hostname might not resolve during nginx startup, causing nginx to fail to bind to the specified TCP socket.</p><p>Finally, if the directive is absent, <code>*:80</code> is used.</p><h2 id=minimal-configuration>Minimal Configuration<a hidden class=anchor aria-hidden=true href=#minimal-configuration>#</a></h2><p>With all this knowledge, we should be able to create and understand the minimal configuration needed to run nginx.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=c1># /etc/nginx/nginx.conf
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>events</span> <span class=p>{}</span>                   <span class=c1># defining the event context is necessary for the configuration to be considered valid
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>http</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=kn>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span>  <span class=s>szulinek.pl</span>  <span class=s>www.szulinek.pl</span>  <span class=s>*.szulinek.pl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#34;Welcome&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=root-location-and-try_files-directives>root, location, and try_files Directives<a hidden class=anchor aria-hidden=true href=#root-location-and-try_files-directives>#</a></h2><h3 id=root-directive>root Directive<a hidden class=anchor aria-hidden=true href=#root-directive>#</a></h3><p>The root directive sets the main directory for requests, allowing nginx to map incoming requests to the filesystem.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>server_name</span> <span class=s>szulinek.pl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>root</span> <span class=s>/var/www/szulinek.pl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This enables nginx to serve server content according to the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>szulinek.pl:80/index.html</span>     <span class=c1># serves /var/www/szulinek.plm/index.html
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>szulinek.pl</span><span class=p>:</span><span class=mi>80</span><span class=s>/foo/index.html</span> <span class=c1># serves /var/www/szulinek.plm/foo/index.html
</span></span></span></code></pre></div><h3 id=location-directive>location Directive<a hidden class=anchor aria-hidden=true href=#location-directive>#</a></h3><p>The <code>location</code> directive sets configuration based on the requested URI.</p><p><code>location [modifier] path</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>location</span> <span class=s>/foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1># ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>When no modifier is specified, the path is treated as a prefix, after which anything can follow. The above example will match:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>/foo</span>
</span></span><span class=line><span class=cl><span class=s>/fooo</span>
</span></span><span class=line><span class=cl><span class=s>/foo123</span>
</span></span><span class=line><span class=cl><span class=s>/foo/bar/index.html</span>
</span></span><span class=line><span class=cl><span class=s>...</span>
</span></span></code></pre></div><p>Moreover, multiple <code>location</code> directives can be used within the same context:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>server_name</span> <span class=s>szulinek.pl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>root</span> <span class=s>/var/www/szulinek.pl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#34;root&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>location</span> <span class=s>/foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#34;foo&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>szulinek.pl:80</span>   <span class=s>/</span>       <span class=c1># =&gt; &#34;root&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>szulinek.pl</span><span class=p>:</span><span class=mi>80</span>   <span class=s>/foo</span>    <span class=c1># =&gt; &#34;foo&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>szulinek.pl</span><span class=p>:</span><span class=mi>80</span>   <span class=s>/foo123</span> <span class=c1># =&gt; &#34;foo&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>szulinek.pl</span><span class=p>:</span><span class=mi>80</span>   <span class=s>/bar</span>    <span class=c1># =&gt; &#34;root&#34;
</span></span></span></code></pre></div><p>Nginx also provides several modifiers that can be used in conjunction with <code>location</code>. These modifiers affect which location block will be used, as each modifier has an associated order.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>=</span>           <span class=s>-</span> <span class=s>Exact</span> <span class=s>match</span>
</span></span><span class=line><span class=cl><span class=s>^~</span>          <span class=s>-</span> <span class=s>Preferential</span> <span class=s>match</span>
</span></span><span class=line><span class=cl><span class=p>~</span> <span class=sr>&amp;&amp;</span> <span class=p>~</span><span class=sr>*</span>     <span class=s>-</span> <span class=s>Regular</span> <span class=s>expression</span> <span class=s>match</span>
</span></span><span class=line><span class=cl><span class=s>no</span> <span class=s>modifier</span> <span class=s>-</span> <span class=s>Prefix</span> <span class=s>match</span>
</span></span></code></pre></div><p>Nginx first checks for any exact matches. If none are found, it checks preferential matches. If that match also fails, regex matches are tested in the order they appear. If everything else fails, the last resort is a prefix match.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>location</span> <span class=s>/match</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#39;Prefix</span> <span class=s>match:</span> <span class=s>matches</span> <span class=s>anything</span> <span class=s>starting</span> <span class=s>with</span> <span class=s>/match&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>location</span> <span class=p>~</span><span class=sr>*</span> <span class=s>/match[0-9]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#39;Case-sensitive</span> <span class=s>regex</span> <span class=s>match&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>location</span> <span class=p>~</span> <span class=sr>/MATCH[0-9]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#39;Case-insensitive</span> <span class=s>regex</span> <span class=s>match&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>location</span> <span class=s>^~</span> <span class=s>/match0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#39;Preferential</span> <span class=s>match&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>location</span> <span class=p>=</span> <span class=s>/match</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#39;Exact</span> <span class=s>match&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>/match</span>     <span class=c1># =&gt; &#39;Exact match&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=s>/match0</span>    <span class=c1># =&gt; &#39;Preferential match&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=s>/match1</span>    <span class=c1># =&gt; &#39;Case-sensitive regex match&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=s>/MATCH1</span>    <span class=c1># =&gt; &#39;Case-insensitive regex match&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=s>/match-abc</span> <span class=c1># =&gt; &#39;Prefix match: matches anything starting with /match&#39;
</span></span></span></code></pre></div><h3 id=try_files-directive>try_files Directive<a hidden class=anchor aria-hidden=true href=#try_files-directive>#</a></h3><p>This directive will attempt different paths and return the one that&rsquo;s found.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>try_files</span> <span class=nv>$uri</span> <span class=s>index.html</span> <span class=p>=</span><span class=mi>404</span><span class=p>;</span>
</span></span></code></pre></div><p>So for <code>/foo.html</code>, it will try to return files in the following order:</p><ol><li>$uri ( /foo.html );</li><li>index.html;</li><li>If none are found: 404.</li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/en/tags/nginx/>Nginx</a></li><li><a href=http://localhost:1313/en/tags/webserver/>Webserver</a></li></ul><nav class=paginav><a class=next href=http://localhost:1313/en/posts/display-wifi-password/><span class=title>Next »</span><br><span>How to display Wifi password?</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/en/>IT Tech Anytime</a></span>
<span>Powered by
<a href=https://szulinek.pl rel="noopener noreferrer" target=_blank>Adam Hałdaś</a>
</span>- Ostrów Wielkopolski</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script src=/js/custom.js></script></body></html>