<!doctype html><html lang=pl dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="noindex, nofollow"><title>Nginx proxy i serwer www | IT Tech Anytime</title>
<meta name=keywords content="nginx,webserver"><meta name=description content="Nginx proxy and webserver"><meta name=author content><link rel=canonical href=http://localhost:1313/pl/posts/nginx/><link crossorigin=anonymous href=/assets/css/stylesheet.d13c3c6200e155c2196e3ebb0e154eb2c43e63128415ebb5249050b767479b1a.css integrity="sha256-0Tw8YgDhVcIZbj67DhVOssQ+YxKEFeu1JJBQt2dHmxo=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/assets/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/assets/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/assets/favicon/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/assets/favicon/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/en/posts/nginx/><link rel=alternate hreflang=pl href=http://localhost:1313/pl/posts/nginx/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/pl/ accesskey=h title="Szulinek IT (Alt + H)"><img src=http://localhost:1313/img/logo.png alt aria-label=logo height=40>Szulinek IT</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=http://localhost:1313/en/ title=English aria-label=:en:>En</a></li></ul></div></div><ul id=menu><li><a href=http://localhost:1313/pl/about title=Whoami><span>Whoami</span></a></li><li><a href=http://localhost:1313/pl/services/ title=Usługi><span>Usługi</span></a></li><li><a href=http://localhost:1313/pl/posts/ title=Blog><span>Blog</span></a></li><li><a href=http://localhost:1313/pl/www/ title=Strony><span>Strony</span></a></li><li><a href=http://localhost:1313/pl/contact/ title=Kontakt><span>Kontakt</span></a></li><li><a href=https://portfolio.szulinek.pl title=Portfolio><span>Portfolio</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul><button class=hamburger>
<span class=hamburger__box><span class=hamburger__inner></span></span></button></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/pl/>Strona Główna</a>&nbsp;»&nbsp;<a href=http://localhost:1313/pl/posts/>Posts</a></div><h1 class=post-title>Nginx proxy i serwer www</h1><div class=post-description>Nginx proxy and webserver</div><div class=post-meta>&lt;span title='2024-04-02 21:30:35 +0200 CEST'>kwietnia 2, 2024&lt;/span>&amp;nbsp;·&amp;nbsp;7 min&amp;nbsp;·&amp;nbsp;1321 słów&nbsp;|&nbsp;Tłumaczenia:<ul class=i18n_list><li><a href=http://localhost:1313/en/posts/nginx/>En</a></li></ul></div></header><figure class=entry-cover><img loading=lazy src=http://localhost:1313/img/post-images/nginxx.png alt=nginx></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Spis treści</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#wprowadzenie>Wprowadzenie:</a><ul><li><a href=#dziś-skupimy-się-na>Dziś skupimy się na:</a></li></ul></li><li><a href=#czym-jest-nginx>Czym jest Nginx?</a></li><li><a href=#podstawowe-polecenia>Podstawowe polecenia:</a></li><li><a href=#dyrektywa-i-kontekst>Dyrektywa i Kontekst</a></li><li><a href=#rodzaje-dyrektyw>Rodzaje dyrektyw</a><ul><li><a href=#normalne>Normalne</a></li><li><a href=#tablica>Tablica</a></li><li><a href=#dyrektywa-akcji>Dyrektywa akcji</a></li></ul></li><li><a href=#obsługa-żądań>Obsługa żądań</a><ul><li><a href=#dyrektywa-server_name>Dyrektywa server_name</a></li><li><a href=#dyrektywa-listen>Dyrektywa listen</a></li></ul></li><li><a href=#minimalna-konfiguracja>Minimalna konfiguracja</a></li><li><a href=#dyrektywa-root-location-i-try_files>Dyrektywa root, location i try_files</a><ul><li><a href=#dyrektywa-root>Dyrektywa root</a></li><li><a href=#dyrektywa-location>Dyrektywa location</a></li><li><a href=#dyrektywa-try_files>Dyrektywa try_files</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=wprowadzenie>Wprowadzenie:<a hidden class=anchor aria-hidden=true href=#wprowadzenie>#</a></h2><h3 id=dziś-skupimy-się-na>Dziś skupimy się na:<a hidden class=anchor aria-hidden=true href=#dziś-skupimy-się-na>#</a></h3><ul><li><em>Podstawowe pojęcia:</em> poznanie różnicy między dyrektywą a kontekstem, model dziedziczenia i kolejność, w jakiej nginx wybiera bloki serwera i lokalizacje.</li></ul><h2 id=czym-jest-nginx>Czym jest Nginx?<a hidden class=anchor aria-hidden=true href=#czym-jest-nginx>#</a></h2><p>Nginx to wszechstronny serwer WWW znany ze swojej wyjątkowej szybkości. Oprócz serwowania treści internetowych, działa jako reverse serwer proxy i proxy, ułatwiając płynną integrację z wolniejszymi serwerami upstream, takimi jak Unicorn lub Puma. Nginx umożliwia dystrybucję ruchu poprzez równoważenie obciążenia, obsługuje strumieniowanie mediów, dynamiczne zmienianie rozmiaru obrazów, buforowanie treści i wiele więcej. Jego architektura składa się z procesu głównego nadzorującego procesy robocze odpowiedzialne za obsługę żądań, co zapewnia efektywną pracę.</p><h2 id=podstawowe-polecenia>Podstawowe polecenia:<a hidden class=anchor aria-hidden=true href=#podstawowe-polecenia>#</a></h2><p>Aby uruchomić nginx, wystarczy wpisać:</p><pre tabindex=0><code>[sudo] nginx
</code></pre><p>Gdy twój serwer nginx działa, możesz go zarządzać, wysyłając sygnały:</p><pre tabindex=0><code>[sudo] nginx -s signal
</code></pre><p>Dostępne sygnały:</p><ul><li><code>stop:</code> szybkie zatrzymanie</li><li><code>quit:</code> grzeczne zatrzymanie (czeka na zakończenie pracy pracowników)</li><li><code>reload:</code> ponowne wczytanie pliku konfiguracyjnego</li><li><code>reopen:</code> ponowne otwarcie plików dziennika</li></ul><h2 id=dyrektywa-i-kontekst>Dyrektywa i Kontekst<a hidden class=anchor aria-hidden=true href=#dyrektywa-i-kontekst>#</a></h2><p>Domyślnie plik konfiguracyjny nginx znajduje się pod:</p><p><code>/etc/nginx/nginx.conf</code>,</p><p><code>/usr/local/etc/nginx/nginx.conf</code>,</p><p>lub <code>/usr/local/nginx/conf/nginx.conf</code></p><p>Ten plik składa się z:</p><ul><li>dyrektywa: opcja składająca się z nazwy i parametrów; powinna kończyć się średnikiem</li></ul><p><code>gzip on;</code></p><ul><li>kontekst: sekcja, w której można deklarować dyrektywy (podobnie jak w zakresie w językach programowania)</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>
</span></span><span class=line><span class=cl>worker_processes 2<span class=p>;</span> <span class=c1># dyrektywa w kontekście globalnym</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>http <span class=o>{</span>              <span class=c1># kontekst http</span>
</span></span><span class=line><span class=cl>    gzip on<span class=p>;</span>        <span class=c1># dyrektywa w kontekście http</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  server <span class=o>{</span>          <span class=c1># kontekst serwera</span>
</span></span><span class=line><span class=cl>    listen 80<span class=p>;</span>      <span class=c1># dyrektywa w kontekście serwera</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=rodzaje-dyrektyw>Rodzaje dyrektyw<a hidden class=anchor aria-hidden=true href=#rodzaje-dyrektyw>#</a></h2><p>Musisz uważać, gdy używasz tej samej dyrektywy w wielu kontekstach, ponieważ model dziedziczenia różni się dla różnych dyrektyw. Istnieją 3 rodzaje dyrektyw, z których każdy ma swój własny model dziedziczenia.</p><h3 id=normalne>Normalne<a hidden class=anchor aria-hidden=true href=#normalne>#</a></h3><p>Ma jedną wartość na kontekst. Ponadto może być zdefiniowane tylko raz w kontekście. Podkonteksty mogą zastępować dyrektywę rodzica, ale to zastąpienie będzie ważne tylko w danym podkontekście.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gzip on<span class=p>;</span>
</span></span><span class=line><span class=cl>gzip off<span class=p>;</span> <span class=c1># nielegalne jest posiadanie 2 normalnych dyrektyw w tym samym kontekście</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>  location /downloads <span class=o>{</span>
</span></span><span class=line><span class=cl>    gzip off<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  location /assets <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1># gzip jest tutaj</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=tablica>Tablica<a hidden class=anchor aria-hidden=true href=#tablica>#</a></h3><p>Dodanie wielu dyrektyw w tym samym kontekście spowoduje dodanie wartości, zamiast całkowicie je nadpisywać. Zdefiniowanie dyrektywy w podkontekście spowoduje zastąpienie WSZYSTKICH wartości rodzica w danym podkontekście.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>error_log</span> <span class=s>/var/log/nginx/error.log</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>error_log</span> <span class=s>/var/log/nginx/error_notice.log</span> <span class=s>notice</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>error_log</span> <span class=s>/var/log/nginx/error_debug.log</span> <span class=s>debug</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>location</span> <span class=s>/downloads</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1># to zastąpi wszystkie dyrektywy nadrzędne
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>error_log</span> <span class=s>/var/log/nginx/error_downloads.log</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=dyrektywa-akcji>Dyrektywa akcji<a hidden class=anchor aria-hidden=true href=#dyrektywa-akcji>#</a></h3><p>Działania to dyrektywy, które coś zmieniają. Ich zachowanie dziedziczenia będzie zależało od modułu.</p><p>Na przykład, w przypadku dyrektywy rewrite, każda pasująca dyrektywa zostanie wykonana:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>rewrite</span> <span class=s>^</span> <span class=s>/foobar</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>location</span> <span class=s>/foobar</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>rewrite</span> <span class=s>^</span> <span class=s>/foo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>rewrite</span> <span class=s>^</span> <span class=s>/bar</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Jeśli użytkownik spróbuje pobrać /cokolwiek:</p><ul><li>wykonana zostanie przekierowanie serwera, przekierowując z /cokolwiek, na /foobar</li><li>dopasowana zostanie lokalizacja /foobar</li><li>wykonane zostanie pierwsze przekierowanie lokalizacji, przekierowując z /foobar, na /foo</li><li>wykonane zostanie drugie przekierowanie lokalizacji, przekierowując z /foo, na /bar</li></ul><p>Jest to inne zachowanie niż to, które zapewnia dyrektywa return:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>200</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>404</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>W powyższym przypadku natychmiast zwrócony zostanie status <code>200</code>.</p><h2 id=obsługa-żądań>Obsługa żądań<a hidden class=anchor aria-hidden=true href=#obsługa-żądań>#</a></h2><p>Wewnątrz nginx możesz określić wiele serwerów wirtualnych, każdy opisany przez kontekst <code>server { }</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>listen</span>      <span class=s>*:80</span> <span class=s>default_server</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>server_name</span> <span class=s>szulinek.pl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#34;Witaj</span> <span class=s>z</span> <span class=s>szulinek.pl&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>listen</span>      <span class=s>*:80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>server_name</span> <span class=s>foo.co</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#34;Witaj</span> <span class=s>z</span> <span class=s>foo.co&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>listen</span>      <span class=s>*:81</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>server_name</span> <span class=s>bar.co</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#34;Witaj</span> <span class=s>z</span> <span class=s>bar.co&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>To pozwoli nginxowi na określenie, jak obsługiwać przychodzące żądania. Nginx najpierw sprawdzi dyrektywę listen, aby sprawdzić, który wirtualny serwer nasłuchuje na danej kombinacji IP:port. Następnie wartość z dyrektywy server_name zostanie sprawdzona w stosunku do nagłówka Host, który przechowuje nazwę domeny serwera.</p><p>Nginx wybierze wirtualny serwer w następującej kolejności:</p><ul><li>Serwer słuchający na IP:port, z pasującą dyrektywą server_name;</li><li>Serwer słuchający na IP:port, z flagą default_server;</li><li>Serwer słuchający na IP:port, pierwszy zdefiniowany;</li><li>Jeśli nie ma dopasowań, odrzuć połączenie.</li></ul><p>W powyższym przykładzie oznacza to:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>Żądanie</span> <span class=s>dla</span> <span class=n>foo.co</span><span class=p>:</span><span class=mi>80</span>     <span class=p>=</span><span class=s>&gt;</span> <span class=s>&#34;Witaj</span> <span class=s>z</span> <span class=s>foo.co&#34;</span>
</span></span><span class=line><span class=cl><span class=s>Żądanie</span> <span class=s>dla</span> <span class=n>www.foo.co</span><span class=p>:</span><span class=mi>80</span> <span class=p>=</span><span class=s>&gt;</span> <span class=s>&#34;Witaj</span> <span class=s>z</span> <span class=s>szulinek.pl&#34;</span>
</span></span><span class=line><span class=cl><span class=s>Żądanie</span> <span class=s>dla</span> <span class=n>bar.co</span><span class=p>:</span><span class=mi>80</span>     <span class=p>=</span><span class=s>&gt;</span> <span class=s>&#34;Witaj</span> <span class=s>z</span> <span class=s>szulinek.pl&#34;</span>
</span></span><span class=line><span class=cl><span class=s>Żądanie</span> <span class=s>dla</span> <span class=n>bar.co</span><span class=p>:</span><span class=mi>81</span>     <span class=p>=</span><span class=s>&gt;</span> <span class=s>&#34;Witaj</span> <span class=s>z</span> <span class=s>bar.co&#34;</span>
</span></span><span class=line><span class=cl><span class=s>Żądanie</span> <span class=s>dla</span> <span class=n>foo.co</span><span class=p>:</span><span class=mi>81</span>     <span class=p>=</span><span class=s>&gt;</span> <span class=s>&#34;Witaj</span> <span class=s>z</span> <span class=s>bar.co&#34;</span>
</span></span></code></pre></div><h3 id=dyrektywa-server_name>Dyrektywa server_name<a hidden class=anchor aria-hidden=true href=#dyrektywa-server_name>#</a></h3><p>Dyrektywa <code>server_name</code> akceptuje wiele wartości. Obsługuje również dopasowanie za pomocą symboli wieloznacznych i wyrażeń regularnych.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server_name</span> <span class=s>szulinek.pl</span> <span class=s>www.szulinek.pl</span><span class=p>;</span> <span class=c1># dokładne dopasowanie
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>server_name</span> <span class=s>*.szulinek.pl</span><span class=p>;</span>              <span class=c1># dopasowanie za pomocą symboli wieloznacznych
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>server_name</span> <span class=s>szulinek.*</span><span class=p>;</span>                 <span class=c1># dopasowanie za pomocą symboli wieloznacznych
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>server_name</span>  <span class=p>~</span><span class=sr>^[0-9]*\.szulinek\.pl$;</span>   <span class=c1># dopasowanie za pomocą wyrażeń regularnych
</span></span></span></code></pre></div><p>W przypadku niejednoznaczności nginx stosuje następującą kolejność:</p><ol><li>Dokładna nazwa;</li><li>Najdłuższa nazwa symboliczna rozpoczynająca się od gwiazdki, np. “*.przykład.org”;</li><li>Najdłuższa nazwa symboliczna kończąca się gwiazdką, np. “poczta.*”;</li><li>Pierwsze dopasowanie wyrażenia regularnego (w kolejności pojawienia się w pliku konfiguracyjnym).</li></ol><p>Nginx przechowuje 3 tabele haszowe: dokładne nazwy, symbole wieloznaczne rozpoczynające się od gwiazdki oraz symbole wieloznaczne kończące się gwiazdką. Jeśli wynik nie znajduje się w żadnej z tabel, wyrażenia regularne będą testowane sekwencyjnie.</p><p>Warto pamiętać, że</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server_name</span> <span class=s>.szulinek.pl</span><span class=p>;</span>
</span></span></code></pre></div><p>jest skrótem od:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server_name</span>  <span class=s>szulinek.pl</span>  <span class=s>www.szulinek.pl</span>  <span class=s>*.szulinek.pl</span><span class=p>;</span>
</span></span></code></pre></div><p>Z jedną różnicą: <code>.szulinek.pl</code> jest przechowywane w drugiej tabeli, co oznacza, że jest nieco wolniejsze niż jawnie zadeklarowane.</p><h3 id=dyrektywa-listen>Dyrektywa listen<a hidden class=anchor aria-hidden=true href=#dyrektywa-listen>#</a></h3><p>W większości przypadków zauważysz, że dyrektywa <code>listen</code> akceptuje wartości IP:port.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>listen</span> <span class=n>127.0.0.1</span><span class=p>:</span><span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>listen</span> <span class=mi>127</span><span class=s>.0.0.1</span><span class=p>;</span>    <span class=c1># domyślnie używany jest port :80
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>listen</span> <span class=s>*:81</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>listen</span> <span class=mi>81</span><span class=p>;</span>           <span class=c1># domyślnie używane są wszystkie adresy IP
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>listen</span> <span class=s>[::]:80</span><span class=p>;</span>      <span class=c1># adresy IPv6
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>listen</span> <span class=s>[::1]</span><span class=p>;</span>        <span class=c1># adresy IPv6
</span></span></span></code></pre></div><p>Jednak można również określić gniazda domeny UNIX:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>listen</span> <span class=s>unix:/var/run/nginx.sock</span><span class=p>;</span>
</span></span></code></pre></div><p>Można nawet używać nazw hostów:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>listen</span> <span class=n>localhost</span><span class=p>:</span><span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>listen</span> <span class=n>szulinek.pl</span><span class=p>:</span><span class=mi>80</span><span class=p>;</span>
</span></span></code></pre></div><p>Należy jednak używać tego ostrożnie, ponieważ nazwa hosta może nie zostać rozwiązana podczas uruchamiania nginx, co powoduje, że nginx nie będzie mógł zbindować na określonym gnieździe TCP.</p><p>Wreszcie, jeśli dyrektywa nie jest obecna, używane jest <code>*:80</code>.</p><h2 id=minimalna-konfiguracja>Minimalna konfiguracja<a hidden class=anchor aria-hidden=true href=#minimalna-konfiguracja>#</a></h2><p>Z całej tej wiedzy powinniśmy być w stanie stworzyć i zrozumieć minimalną konfigurację potrzebną do uruchomienia nginx.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=c1># /etc/nginx/nginx.conf
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>events</span> <span class=p>{}</span>                   <span class=c1># konieczne jest zdefiniowanie kontekstu event, aby konfiguracja była uznawana za ważną
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>http</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=kn>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span>  <span class=s>szulinek.pl</span>  <span class=s>www.szulinek.pl</span>  <span class=s>*.szulinek.pl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#34;Witaj&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=dyrektywa-root-location-i-try_files>Dyrektywa root, location i try_files<a hidden class=anchor aria-hidden=true href=#dyrektywa-root-location-i-try_files>#</a></h2><h3 id=dyrektywa-root>Dyrektywa root<a hidden class=anchor aria-hidden=true href=#dyrektywa-root>#</a></h3><p>Dyrektywa root ustawia główny katalog dla żądań, pozwalając nginxowi odwzorować przychodzące żądanie na systemie plików.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>server_name</span> <span class=s>szulinek.pl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>root</span> <span class=s>/var/www/szulinek.pl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Co pozwala nginxowi zwracać treść serwera zgodnie z żądaniem:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>szulinek.pl:80/index.html</span>     <span class=c1># zwraca /var/www/szulinek.plm/index.html
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>szulinek.pl</span><span class=p>:</span><span class=mi>80</span><span class=s>/foo/index.html</span> <span class=c1># zwraca /var/www/szulinek.plm/foo/index.html
</span></span></span></code></pre></div><h3 id=dyrektywa-location>Dyrektywa location<a hidden class=anchor aria-hidden=true href=#dyrektywa-location>#</a></h3><p>Dyrektywa <code>location</code> ustawia konfigurację w zależności od żądanego URI.</p><p><code>location [modifier] path</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>location</span> <span class=s>/foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1># ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>Gdy nie jest określony żaden modyfikator, ścieżka jest traktowana jako prefiks, po którym może nastąpić cokolwiek. Powyższy przykład będzie pasował do:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>/foo</span>
</span></span><span class=line><span class=cl><span class=s>/fooo</span>
</span></span><span class=line><span class=cl><span class=s>/foo123</span>
</span></span><span class=line><span class=cl><span class=s>/foo/bar/index.html</span>
</span></span><span class=line><span class=cl><span class=s>...</span>
</span></span></code></pre></div><p>Ponadto w danym kontekście można użyć wielu dyrektyw <code>location</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>server_name</span> <span class=s>szulinek.pl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>root</span> <span class=s>/var/www/szulinek.pl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#34;root&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>location</span> <span class=s>/foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#34;foo&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>szulinek.pl:80</span>   <span class=s>/</span>       <span class=c1># =&gt; &#34;root&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>szulinek.pl</span><span class=p>:</span><span class=mi>80</span>   <span class=s>/foo</span>    <span class=c1># =&gt; &#34;foo&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>szulinek.pl</span><span class=p>:</span><span class=mi>80</span>   <span class=s>/foo123</span> <span class=c1># =&gt; &#34;foo&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>szulinek.pl</span><span class=p>:</span><span class=mi>80</span>   <span class=s>/bar</span>    <span class=c1># =&gt; &#34;root&#34;
</span></span></span></code></pre></div><p>Nginx udostępnia również kilka modyfikatorów, które można używać w połączeniu z <code>location</code>. Te modyfikatory wpływają na to, który blok location zostanie użyty, ponieważ każdy modyfikator ma przypisaną kolejność.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>=</span>           <span class=s>-</span> <span class=s>Dokładne</span> <span class=s>dopasowanie</span>
</span></span><span class=line><span class=cl><span class=s>^~</span>          <span class=s>-</span> <span class=s>Preferencyjne</span> <span class=s>dopasowanie</span>
</span></span><span class=line><span class=cl><span class=p>~</span> <span class=sr>&amp;&amp;</span> <span class=p>~</span><span class=sr>*</span>     <span class=s>-</span> <span class=s>Dopasowanie</span> <span class=s>za</span> <span class=s>pomocą</span> <span class=s>wyrażeń</span> <span class=s>regularnych</span>
</span></span><span class=line><span class=cl><span class=s>bez</span> <span class=s>modyfikatora</span> <span class=s>-</span> <span class=s>Prefiksowe</span> <span class=s>dopasowanie</span>
</span></span></code></pre></div><p>Nginx najpierw sprawdzi, czy są jakiekolwiek dokładne dopasowania. Jeśli nie znajdzie żadnego, sprawdzi preferencyjne. Jeśli to dopasowanie również zawiedzie, testowane będą dopasowania regex w kolejności ich pojawienia się. Jeśli wszystko inne zawiedzie, zostanie użyte ostatnie dopasowanie prefiksowe.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>location</span> <span class=s>/match</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#39;Prefiksowe</span> <span class=s>dopasowanie:</span> <span class=s>pasuje</span> <span class=s>do</span> <span class=s>wszystkiego,</span> <span class=s>co</span> <span class=s>zaczyna</span> <span class=s>się</span> <span class=s>od</span> <span class=s>/match&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>location</span> <span class=p>~</span><span class=sr>*</span> <span class=s>/match[0-9]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#39;Wrażliwe</span> <span class=s>na</span> <span class=s>wielkość</span> <span class=s>liter</span> <span class=s>dopasowanie</span> <span class=s>za</span> <span class=s>pomocą</span> <span class=s>wyrażeń</span> <span class=s>regularnych&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>location</span> <span class=p>~</span> <span class=sr>/MATCH[0-9]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#39;Dopasowanie</span> <span class=s>wrażliwe</span> <span class=s>na</span> <span class=s>wielkość</span> <span class=s>liter</span> <span class=s>za</span> <span class=s>pomocą</span> <span class=s>wyrażeń</span> <span class=s>regularnych&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>location</span> <span class=s>^~</span> <span class=s>/match0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#39;Preferencyjne</span> <span class=s>dopasowanie&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>location</span> <span class=p>=</span> <span class=s>/match</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>return</span> <span class=mi>200</span> <span class=s>&#39;Dokładne</span> <span class=s>dopasowanie&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>/match</span>     <span class=c1># =&gt; &#39;Dokładne dopasowanie&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=s>/match0</span>    <span class=c1># =&gt; &#39;Preferencyjne dopasowanie&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=s>/match1</span>    <span class=c1># =&gt; &#39;Wrażliwe na wielkość liter dopasowanie za pomocą wyrażeń regularnych&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=s>/MATCH1</span>    <span class=c1># =&gt; &#39;Dopasowanie wrażliwe na wielkość liter za pomocą wyrażeń regularnych&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=s>/match-abc</span> <span class=c1># =&gt; &#39;Prefiksowe dopasowanie: pasuje do wszystkiego, co zaczyna się od /match&#39;
</span></span></span></code></pre></div><h3 id=dyrektywa-try_files>Dyrektywa try_files<a hidden class=anchor aria-hidden=true href=#dyrektywa-try_files>#</a></h3><p>Ta dyrektywa spróbuje różnych ścieżek i zwróci tę, która zostanie znaleziona.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>try_files</span> <span class=nv>$uri</span> <span class=s>index.html</span> <span class=p>=</span><span class=mi>404</span><span class=p>;</span>
</span></span></code></pre></div><p>Tak więc dla <code>/foo.html</code>, spróbuje zwrócić pliki w następującej kolejności:</p><ol><li>$uri ( /foo.html );</li><li>index.html;</li><li>Jeśli żaden nie zostanie znaleziony: 404.</li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/pl/tags/nginx/>Nginx</a></li><li><a href=http://localhost:1313/pl/tags/webserver/>Webserver</a></li></ul><nav class=paginav><a class=next href=http://localhost:1313/pl/posts/display-wifi-password/><span class=title>Następna »</span><br><span>Jak wyświetlić hasło do Wifi?</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/pl/>IT Tech Anytime</a></span>
<span>Powered by
<a href=https://szulinek.pl rel="noopener noreferrer" target=_blank>Adam Hałdaś</a>
</span>- Ostrów Wielkopolski</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Kopiuj";function s(){t.innerHTML="Skopiowano!",setTimeout(()=>{t.innerHTML="Kopiuj"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script src=/js/custom.js></script></body></html>